{% extends "layout.html" %}
{% block body %}
<script type="text/javascript">
function addScript() {
  var e = document.createElement('div');
  e.innerHTML = '<div class="form-group"><div class="form-inline">' +
                '<label for="script-name">Name:</label> ' +
		'<input type="string" class="form-control" name="script-name" placeholder="Name"/>' +
                '<button onclick="e=event.target.parentNode.parentNode; e.parentNode.removeChild(e)" class="btn btn-sm"><span class="glyphicon glyphicon-remove" title="delete script"></span></button>' +
                '</div>' +
		'<textarea name="script-content" class="form-control" rows="6"></textarea>' +
                '</div>';
  document.getElementById('scripts').appendChild(e);
}
</script>

  <h3>{{g.user.nickname}} settings</h3>
  <table class="table table-condensed">
    <tr><th>Email</th><td>{{g.user.email}}</td></tr>
    <tr><th>Approved</th><td>{{g.user.approved}}</td></tr>
  </table>

  <h3>User Defined Init Scripts</h3>
  <form action="{{ url_for('user_settings') }}" method=post>
    <div id="scripts">
      {% for script in g.user.init_scripts %}
      <div class="form-group">
        <div class="form-inline">
          <label for="script-name">Name:</label>
          <input type="string" class="form-control" name="script-name" value="{{script.name|safe}}">
          <button onclick="e=event.target.parentNode.parentNode; e.parentNode.removeChild(e)" class="btn btn-sm"><span class="glyphicon glyphicon-remove" title="delete script"></span></button>
        </div>
        <textarea name="script-content" class="form-control" rows="6">{{script.content|safe}}</textarea>
      </div>
      {% endfor %}
    </div>
    <button type="button" class="btn btn-default" onclick="addScript()">
      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Create Script
    </button>
    <br/>
    <input type="submit" class="btn btn-default" value="Submit"/>
  </form>
{% if g.user.admin %}
  <h3>Global Settings</h3>
  <form action="{{ url_for('global_settings') }}" method=post>
    <table class="table table-condensed">
      <tr>
        <th>Debug</th>
	<td><input name="DEBUG" type="checkbox" {%if settings.DEBUG%}checked{%endif%}/></td>
      </tr>
      <tr>
        <th>Auto Approve Users</th>
	<td><input name="AUTO_APPROVE_USER" type="checkbox" {%if settings.AUTO_APPROVE_USER%}checked{%endif%}/></td>
      </tr>
      <tr>
        <th>Auto Enlist Hosts</th>
	<td><input name="AUTO_ENLIST_HOSTS" type="checkbox" {%if settings.AUTO_ENLIST_HOSTS%}checked{%endif%}/></td>
      </tr>
    </table>
    <input type="submit" class="btn btn-default" value="Submit"/>
  </form>
  <h3>User admin</h3>
  <form action="{{ url_for('user_admin') }}" method=post>
    <table class="table table-condensed">
      <tr><th>user</th><th>approved</th><th>admin</th></tr>
      {% for user in users %}
      <tr>
        <td>{{user.nickname}}</td>
        <td><input name="approved-{{user.openid}}" type="checkbox" {%if user.approved%}checked{%endif%}/></td>
        <td><input name="admin-{{user.openid}}" type="checkbox" {%if user.admin%}checked{%endif%}/></td>
      </tr>
      {% endfor %}
    </table>
    <input type="submit" class="btn btn-default" value="submit"/>
  </form>
{% endif %}
{% endblock %}
