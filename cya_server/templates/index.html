{% extends "layout.html" %}

{% block body %}
<script type="text/javascript">
function removeContainer(host, container) {
  var form = document.createElement("form");
  form.setAttribute("method", "post");
  form.setAttribute("action", "{{url_for('remove_container')}}");
  var hiddenField = document.createElement("input");
  hiddenField.setAttribute("type", "hidden");
  hiddenField.setAttribute("name", "host");
  hiddenField.setAttribute("value", host);
  form.appendChild(hiddenField);

  hiddenField = document.createElement("input");
  hiddenField.setAttribute("type", "hidden");
  hiddenField.setAttribute("name", "name");
  hiddenField.setAttribute("value", container);
  form.appendChild(hiddenField);
  document.body.appendChild(form);
  form.submit();
}
function reCreateContainer(host, container) {
  var form = document.createElement("form");
  form.setAttribute("method", "post");
  form.setAttribute("action", "{{url_for('recreate_container')}}");
  var hiddenField = document.createElement("input");
  hiddenField.setAttribute("type", "hidden");
  hiddenField.setAttribute("name", "host");
  hiddenField.setAttribute("value", host);
  form.appendChild(hiddenField);

  hiddenField = document.createElement("input");
  hiddenField.setAttribute("type", "hidden");
  hiddenField.setAttribute("name", "name");
  hiddenField.setAttribute("value", container);
  form.appendChild(hiddenField);
  document.body.appendChild(form);
  form.submit();
}
function containerState(host, container, keep_running) {
  var form = document.createElement("form");
  form.setAttribute("method", "post");
  form.setAttribute("action", "{{url_for('start_container')}}");
  var hiddenField = document.createElement("input");
  hiddenField.setAttribute("type", "hidden");
  hiddenField.setAttribute("name", "host");
  hiddenField.setAttribute("value", host);
  form.appendChild(hiddenField);

  hiddenField = document.createElement("input");
  hiddenField.setAttribute("type", "hidden");
  hiddenField.setAttribute("name", "name");
  hiddenField.setAttribute("value", container);
  form.appendChild(hiddenField);

  hiddenField = document.createElement("input");
  hiddenField.setAttribute("type", "hidden");
  hiddenField.setAttribute("name", "keep_running");
  hiddenField.setAttribute("value", keep_running);
  form.appendChild(hiddenField);
  document.body.appendChild(form);
  form.submit();
}
</script>

  {% if session.openid %}
  <a href="{{ url_for('create_container') }}" class="btn btn-default" role="button">
    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Create Container
  </a>
  {% endif %}
  <h2>Hosts</h2>
  <table class="table table-striped">
  <tr>
    <th>Name</th><th>Enlisted</th><th>Online</th><th>Release</th><th>Memory</th><th>CPU's</th><th>Arch</th><th>Containers</th>
  </tr>
  {% for h in hosts %}
    <tr>
      <td><a href="{{url_for('host', name=h.name)}}">{{h.name}}</a></td>
      <td>{{h.enlisted}}</td>
      <td>{{h.online}}</td>
      <td>{{h.distro_codename}}</td>
      <td>{{h.mem_total|filesizeformat}}</td>
      <td>{{h.cpu_total}}</td>
      <td>{{h.cpu_type}}</td>
      <td>{{h.containers|length}}</td>
    </tr>
  {% endfor %}
  </table>

  <h2>Containers</h2>
  <table class="table table-striped">
    <tr><th>Host</th><th>Name</th><th>Template</th><th>Release</th><th>State</th><th>Actions</th></tr>
    {% for h in hosts %}
    {% for c in h.containers %}
    <tr>
      <td><a href="{{url_for('host', name=h.name)}}">{{h.name}}</a></td>
      <td>{{c.name}}</td>
      <td>{{c.template}}</td>
      <td>{{c.release}}</td>
      <td>{{c.state}}</td>
      <td>
        <button onclick="removeContainer('{{h.name}}', '{{c.name}}')" type="button" class="btn btn-sm" aria-label="remove">
          <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
        </button>
        <button onclick="reCreateContainer('{{h.name}}', '{{c.name}}')" type="button" class="btn btn-sm" aria-label="remove">
          <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>
        </button>
	{% if c.state in ('QUEUED', 'RUNNING')%}
          <button onclick="containerState('{{h.name}}', '{{c.name}}', false)" type="button" class="btn btn-sm" aria-label="stop">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
          </button>
	{% endif %}
	{% if c.state == 'STOPPED'%}
          <button onclick="containerState('{{h.name}}', '{{c.name}}', true)" type="button" class="btn btn-sm" aria-label="start">
            <span class="glyphicon glyphicon-play" aria-hidden="true"></span>
          </button>
	{% endif %}
    </tr>
    {% endfor %}
    {% endfor %}
  </table>
{% endblock %}
